Запросить все даты
высчитать 180 дней от сегодняшнего дня
посчитать количество дней нахождения в стране от -180 до сегодняшнего дня
проверить не больше ли 90 дней.

если дата въезда раньше -180 дня, то считать от 180.